<%- include('../layouts/header') %>

<div class="container">
    <h2 style="margin-bottom: 20px;">View Schedule by Hall</h2>
    
    <!-- Filter Buttons -->
    <div class="movie-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="Standard">Standard</button>
        <button class="filter-btn" data-filter="IMAX">IMAX</button>
        <button class="filter-btn" data-filter="VIP">VIP</button>
    </div>

    <!-- Search and Filter Controls -->
    <div class="search-filter-bar">
        <div class="search-controls">
            <!-- Search Bar -->
            <div class="search-box">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                <input 
                    type="text" 
                    id="hallSearch" 
                    class="search-input" 
                    placeholder="Search halls..."
                >
            </div>

            <!-- Sort By -->
            <div class="filter-dropdown">
                <select id="sortFilter" class="filter-select">
                    <option value="none">Sort By</option>
                    <option value="nameAZ">Name (A-Z)</option>
                    <option value="nameZA">Name (Z-A)</option>
                    <option value="capacityHigh">Capacity (High-Low)</option>
                    <option value="capacityLow">Capacity (Low-High)</option>
                </select>
            </div>
        </div>

        <!-- Back Button -->
        <div class="create-button-wrapper">
            <a href="/screenings" class="btn btn-secondary">
                ‚Üê Back to Screenings
            </a>
        </div>
    </div>

    <div class="movies-grid">
        <% halls.forEach(hall => { %>
            <a href="/screenings/hall/<%= hall._id %>" 
               class="movie-card-link hall-card-link" 
               data-type="<%= hall.type || 'all' %>"
               data-name="<%= hall.name ? hall.name.toLowerCase() : '' %>"
               data-capacity="<%= hall.capacity || 0 %>">
                <div class="movie-card card">
                    <div class="movie-card-img-wrapper">
                        <img src="<%= hall.pictureUrl || '/images/placeholder.jpg' %>" alt="<%= hall.name %>"
                            class="movie-card-img">
                        <!-- Hall type badge overlay -->
                        <% if (hall.type) { %>
                            <div class="age-badge"><%= hall.type %></div>
                        <% } %>
                    </div>
                    <div class="movie-card-content">
                        <div class="movie-name">
                            <%= hall.name || 'Unnamed Hall' %>
                        </div>
                        <div class="movie-duration">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                                <path d="M1 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2zM1 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V7zM1 12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2z"/>
                            </svg>
                            <%= hall.capacity || 'N/A' %> seats
                        </div>
                    </div>
                </div>
            </a>
        <% }) %>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterBtns = document.querySelectorAll('.filter-btn');
        const hallCards = Array.from(document.querySelectorAll('.hall-card-link'));
        const searchInput = document.getElementById('hallSearch');
        const sortFilter = document.getElementById('sortFilter');
        
        let activeTypeFilter = 'all';

        // Type filter buttons
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                filterBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                activeTypeFilter = this.getAttribute('data-filter');
                applyFiltersAndSort();
            });
        });

        // Search input
        searchInput.addEventListener('input', applyFiltersAndSort);

        // Sort filter
        sortFilter.addEventListener('change', applyFiltersAndSort);

        function applyFiltersAndSort() {
            const searchTerm = searchInput.value.toLowerCase();
            const sortValue = sortFilter.value;
            
            // Filter
            let filteredCards = hallCards.filter(card => {
                const type = card.getAttribute('data-type');
                const name = card.getAttribute('data-name');
                
                const typeMatch = activeTypeFilter === 'all' || type === activeTypeFilter;
                const searchMatch = name.includes(searchTerm);
                
                return typeMatch && searchMatch;
            });
            
            // Sort
            if (sortValue !== 'none') {
                filteredCards.sort((a, b) => {
                    const nameA = a.getAttribute('data-name');
                    const nameB = b.getAttribute('data-name');
                    const capacityA = parseInt(a.getAttribute('data-capacity')) || 0;
                    const capacityB = parseInt(b.getAttribute('data-capacity')) || 0;
                    
                    switch(sortValue) {
                        case 'nameAZ': return nameA.localeCompare(nameB);
                        case 'nameZA': return nameB.localeCompare(nameA);
                        case 'capacityHigh': return capacityB - capacityA;
                        case 'capacityLow': return capacityA - capacityB;
                        default: return 0;
                    }
                });
            }
            
            // Display
            hallCards.forEach(card => card.style.display = 'none');
            filteredCards.forEach(card => card.style.display = 'block');
        }
    });
</script>

<%- include('../layouts/footer') %>
