<%- include('../layouts/header') %>
<link rel="stylesheet" href="/css/hall.css">

  <div class="container">
    <h2 class="mb-30"><%= isEdit ? 'Edit Hall' : 'Create Hall' %></h2>

    <form action="<%= isEdit ? '/halls/edit/' + hall._id : '/halls/create' %>" method="POST"
      enctype="multipart/form-data">

      <div class="hall-form-container">
        
        <!-- Form Fields Section -->
        <div class="hall-form-fields">
          
          <!-- Hall Name -->
          <div class="form-group">
            <div class="label-row">
              <label for="name" class="form-label">HALL NAME *</label>
              <% if (typeof error !== 'undefined' && error) { %>
                <span class="error-inline">
                  <i class="bi bi-exclamation-triangle" style="font-size: 13px;"></i> <%= error %>
                </span>
              <% } %>
            </div>
            <input type="text" id="name" name="name" class="form-control" value="<%= hall ? hall.name : '' %>" required>
          </div>

          <!-- Type -->
          <div class="form-group">
            <label for="type" class="form-label">TYPE *</label>
            <select id="type" name="type" class="form-control" required>
              <option value="">Select Type</option>
              <option value="Standard" <%= hall && hall.type === 'Standard' ? 'selected' : '' %>>Standard</option>
              <option value="IMAX" <%= hall && hall.type === 'IMAX' ? 'selected' : '' %>>IMAX</option>
              <option value="VIP" <%= hall && hall.type === 'VIP' ? 'selected' : '' %>>VIP</option>
            </select>
          </div>

          <!-- Status -->
          <div class="form-group">
            <label for="status" class="form-label">STATUS *</label>
            <select id="status" name="status" class="form-control" required>
              <option value="">Select Status</option>
              <option value="Available" <%= hall && hall.status === 'Available' ? 'selected' : '' %>>Available</option>
              <option value="Under Maintenance" <%= hall && hall.status === 'Under Maintenance' ? 'selected' : '' %>>Under Maintenance</option>
            </select>
          </div>

          <!-- Layout Configuration -->
          <div class="form-row">
            <div class="form-group">
              <label for="rows" class="form-label">ROWS *</label>
              <input type="number" id="rows" name="rows" class="form-control" value="<%= hall && hall.rows ? hall.rows : '' %>" min="1" max="20" required>
            </div>

            <div class="form-group">
              <label for="columns" class="form-label">COLUMNS *</label>
              <input type="number" id="columns" name="columns" class="form-control" value="<%= hall && hall.columns ? hall.columns : '' %>" min="1" max="17" required>
            </div>

            <div class="form-group">
              <label for="wingColumns" class="form-label">WING COLUMNS *</label>
              <input type="number" id="wingColumns" name="wingColumns" class="form-control" value="<%= hall && hall.wingColumns ? hall.wingColumns : '' %>" min="0" max="10" required>
            </div>
          </div>

          <!-- Hidden fields for seat configuration and capacity -->
          <input type="hidden" id="seatConfig" name="seatConfig" value="">
          <input type="hidden" id="capacity" name="capacity" value="">

          <!-- Seat Edit Toolbar -->
          <div class="seat-toolbar">
            <h3 class="section-title-sm">SEAT EDITOR</h3>
            <div class="flex-gap-10">
              <button type="button" id="normalBtn" class="seat-edit-btn active">
                <i class="bi bi-square"></i> Normal
              </button>
              <button type="button" id="removeBtn" class="seat-edit-btn">
                <i class="bi bi-x-square"></i> Remove Seat
              </button>
              <button type="button" id="wheelchairBtn" class="seat-edit-btn">
                <i class="bi bi-universal-access"></i> Wheelchair
              </button>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="movie-detail-actions mt-30">
            <a href="/halls" class="btn btn-secondary">
              ‚Üê Back to Halls
            </a>
            <button type="submit" class="btn btn-primary">
              <%= isEdit ? 'Update Hall' : 'Create Hall' %>
            </button>
          </div>

        </div>

        <!-- Seat Layout Visualization -->
        <div class="hall-seat-layout">
          <h3 class="section-title-sm text-center">SEAT LAYOUT PREVIEW</h3>
          
          <!-- Screen -->
          <div class="screen-display">
            <div class="screen-label">SCREEN</div>
          </div>

          <!-- Seat Grid Container -->
          <div id="seatGrid" class="seat-grid-container">
            <!-- Seats will be generated here by JavaScript -->
          </div>

          <!-- Legend -->
          <div class="seat-legend">
            <div class="legend-item">
              <div class="legend-seat normal"></div>
              <span>Normal</span>
            </div>
            <div class="legend-item">
              <div class="legend-seat removed"></div>
              <span>Removed</span>
            </div>
            <div class="legend-item">
              <div class="legend-seat wheelchair"></div>
              <span>Wheelchair</span>
            </div>
            <div class="legend-item">
              <div class="legend-lane"></div>
              <span>Lane</span>
            </div>
          </div>
        </div>

      </div>
    </form>
  </div>

  <script src="/js/hallForm.js"></script>
  <script>
    // Load existing seat data if editing
    <% if (isEdit && hall && hall.rows && hall.columns) { %>
      <% if (hall.seatConfig) { %>
        try {
          const existingData = <%- JSON.stringify(hall.seatConfig) %>;
          if (window.loadSeatData) {
            window.loadSeatData(existingData);
          }
        } catch(e) {
          console.error('Error loading seat data:', e);
        }
      <% } %>
    <% } %>
  </script>

  <%- include('../layouts/footer') %>

