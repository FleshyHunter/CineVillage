<%- include('../layouts/header') %>

  <div class="container">
    <h2 style="margin-bottom: 30px;"><%= isEdit ? 'Edit Movie' : 'Create Movie' %></h2>

    <div class="movie-detail-container">
      <form action="<%= isEdit ? '/movies/edit/' + movie._id : '/movies/create' %>" method="POST"
        enctype="multipart/form-data" style="display: contents;">

        <!-- Left Side: Movie Poster Upload -->
        <div class="movie-detail-poster">
          <label for="picture" style="cursor: pointer; display: block;">
            <img id="placeholderImg"
              src="<%= isEdit && movie.pictureUrl ? movie.pictureUrl : '/images/cameraplaceholder.jpg' %>"
              alt="Upload movie image"
              style="width: 100%; border-radius: 8px; border: 2px dashed #94a3b8; object-fit: cover; min-height: 400px;">
          </label>
          <input type="file" id="picture" name="picture" accept="image/*" style="display: none;">
          <p class="form-help-text">Click to upload poster</p>
        </div>

        <!-- Right Side: Form Fields -->
        <div class="movie-detail-info">
          
          <!-- Movie Name -->
          <div class="form-group">
            <label for="name" class="form-label">Movie Name * <span style="font-size: 10px; font-weight: 400;">(max 50 characters)</span></label>
            <input type="text" id="name" name="name" class="form-control" value="<%= movie ? movie.name : '' %>" required maxlength="50">
          </div>

          <!-- Row 1: Duration, Rating, Age Restriction -->
          <div class="form-row">
            <div class="form-group">
              <label for="duration" class="form-label">Duration (mins)</label>
              <input type="number" id="duration" name="duration" class="form-control" value="<%= movie ? movie.duration : '' %>" min="1" step="1">
            </div>

            <div class="form-group">
              <label for="rating" class="form-label">Rating</label>
              <input type="number" id="rating" name="rating" class="form-control" value="<%= movie ? movie.rating : '' %>" min="0" max="5" step="0.1">
            </div>

            <div class="form-group">
              <label for="ageRestriction" class="form-label">Age Restriction</label>
              <select id="ageRestriction" name="ageRestriction" class="form-control">
                <option value="">Select</option>
                <option value="G" <%=movie && movie.ageRestriction==='G' ? 'selected' : '' %>>G</option>
                <option value="PG" <%=movie && movie.ageRestriction==='PG' ? 'selected' : '' %>>PG</option>
                <option value="PG13" <%=movie && movie.ageRestriction==='PG13' ? 'selected' : '' %>>PG13</option>
                <option value="NC16" <%=movie && movie.ageRestriction==='NC16' ? 'selected' : '' %>>NC16</option>
                <option value="M18" <%=movie && movie.ageRestriction==='M18' ? 'selected' : '' %>>M18</option>
                <option value="R21" <%=movie && movie.ageRestriction==='R21' ? 'selected' : '' %>>R21</option>
              </select>
            </div>
          </div>

          <!-- Row 2: Producer and Genre -->
          <div class="form-row">
            <div class="form-group">
              <label for="producer" class="form-label">Director</label>
              <input type="text" id="producer" name="producer" class="form-control" value="<%= movie ? movie.producer : '' %>">
            </div>

            <div class="form-group">
              <label for="genre" class="form-label">Genre</label>
              <input type="text" id="genre" name="genre" class="form-control"
                value="<%= movie && Array.isArray(movie.genre) ? movie.genre.join(', ') : (movie ? movie.genre : '') %>"
                placeholder="e.g. Action, Thriller">
            </div>
          </div>

          <!-- Row 3: Language and Subtitle -->
          <div class="form-row">
            <div class="form-group">
              <label for="language" class="form-label">Language</label>
              <select id="language" name="language" class="form-control">
                <option value="">Select</option>
                <option value="English" <%=movie && movie.language==='English' ? 'selected' : '' %>>English</option>
                <option value="Mandarin" <%=movie && movie.language==='Mandarin' ? 'selected' : '' %>>Mandarin</option>
              </select>
            </div>

            <div class="form-group">
              <label for="subtitle" class="form-label">Subtitle</label>
              <select id="subtitle" name="subtitle" class="form-control">
                <option value="">Select</option>
                <option value="English" <%=movie && movie.subtitle==='English' ? 'selected' : '' %>>English</option>
                <option value="Mandarin" <%=movie && movie.subtitle==='Mandarin' ? 'selected' : '' %>>Mandarin</option>
              </select>
            </div>
          </div>

          <!-- Row 4: Release Date and Status -->
          <div class="form-row">
            <div class="form-group">
              <label for="releaseDate" class="form-label">Release Date</label>
              <input type="date" id="releaseDate" name="releaseDate" class="form-control"
                value="<%= movie && movie.releaseDate ? new Date(movie.releaseDate).toISOString().split('T')[0] : '' %>">
            </div>

            <div class="form-group">
              <label for="status" class="form-label">Status</label>
              <select id="status" name="status" class="form-control">
                <option value="">Select</option>
                <option value="New" <%=movie && movie.status==='New' ? 'selected' : '' %>>New</option>
                <option value="Now Showing" <%=movie && movie.status==='Now Showing' ? 'selected' : '' %>>Now Showing</option>
                <option value="Coming Soon" <%=movie && movie.status==='Coming Soon' ? 'selected' : '' %>>Coming Soon</option>
                <option value="Discontinued" <%=movie && movie.status==='Discontinued' ? 'selected' : '' %>>Discontinued</option>
              </select>
            </div>
          </div>

          <!-- Cast (Full Width) -->
          <div class="form-group">
            <label for="cast" class="form-label">Main Cast</label>
            <input type="text" id="cast" name="cast" class="form-control"
              value="<%= movie && Array.isArray(movie.cast) ? movie.cast.join(', ') : (movie ? movie.cast : '') %>"
              placeholder="e.g. Tom Cruise, Zendaya">
          </div>

          <!-- Description (Full Width) -->
          <div class="form-group">
            <label for="description" class="form-label">Synopsis <span style="font-size: 10px; font-weight: 400;">(max 150 characters)</span></label>
            <textarea id="description" name="description" rows="5"
              class="form-control" style="resize: vertical;" maxlength="150"><%= movie ? movie.description : '' %></textarea>
          </div>

          <!-- Action Buttons -->
          <div class="movie-detail-actions">
            <a href="/movies" class="btn btn-secondary">
              ‚Üê Back to Movies
            </a>
            <button type="submit" class="btn btn-primary">
              <%= isEdit ? 'Update Movie' : 'Create Movie' %>
            </button>
          </div>

        </div>

      </form>
    </div>
  </div>

  <script>
    const pictureInput = document.getElementById('picture');
    const placeholderImg = document.getElementById('placeholderImg');

    pictureInput.addEventListener('change', () => {
      const file = pictureInput.files[0];
      if (file) {
        placeholderImg.src = URL.createObjectURL(file);
      }
    });
  </script>

  <%- include('../layouts/footer') %>